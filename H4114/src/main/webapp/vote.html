<div>Sondage en Cours
    <div id="vote" class="container" style="font-size: 25px;font-family:Arial">
    </div>
    <div id="errorMsg"></div>
</div>


<script>
    function clearVote(){
        $("#tableBody").html("");
    }
    $(document).ready(function () {
        $.ajax({
            url: './ParticipantServlet',
            method: 'POST',
            data: {
                action : 'infoSurvey'
            },
            dataType: 'json'
        }).done(function (data) {
            clearVote();
            var response = data;
            console.log(response);
            var state = response.state;
            if(state == 1) {
                //No survey and impossible to create one
                $("#vote").html("<p>Aucun sondage pour le moment, veuillez revenir plus tard!</p>");
            } else if (state == 2) {
                //Moderator
                $("#vote").html("<p>Aucun sondage pour le moment, mais vous pouvez en creer un!</p>");
                var createQuestionDiv = document.createElement("div");
                createQuestionDiv.id = "createQuestion";
                document.getElementById("vote").appendChild(createQuestionDiv);
                $('#createQuestion').load("question-form.html");
            } else if (state == 3) {
                var question = response.question;
                var choices = response.choices;
                var choicesTab = choices.split(";");
                var publicKey = response.publicKey;
                var voteDiv = document.getElementById("vote");
                var questionDiv = document.createElement("div");
                questionDiv.innerHTML = question;
                questionDiv.id = "question";
                voteDiv.appendChild(questionDiv);
                var choicesDiv = document.createElement("div");
                choicesDiv.id = "choices";
                for(i = 0; i<choicesTab.length; i++){
                    var choiceRadio = document.createElement("input");
                    choiceRadio.setAttribute("type", "radio");
                    choiceRadio.setAttribute("name", "voteChoices");
                    choiceRadio.setAttribute("value", choicesTab[i]);    
                    var choiceLabel = document.createElement("label");                
                    choiceLabel.innerHTML = choicesTab[i];
                    choicesDiv.appendChild(choiceRadio);
                    choicesDiv.appendChild(choiceLabel);
                    choicesDiv.appendChild(document.createElement("br"));
                }
                voteDiv.appendChild(choicesDiv);
                var sendButton = document.createElement("button");
                sendButton.id = "sendResponse";
                sendButton.innerHTML = "Vote";
                sendButton.classList.add("btn");
                sendButton.classList.add("btn-primary");
                sendButton.onclick = function(){
                    var radioValue = $("input[name='voteChoices']:checked").val();
                    console.log(radioValue);
                    if(radioValue){
                        $.ajax({
                            url: './ParticipantServlet',
                            method: 'POST',
                            data: {
                                action : 'voteSurvey',
                                response : radioValue
                            },
                            dataType: 'json'
                        });
                    } else {
                        $("#errorMsg").innerHTML("Please select a value!");
                    }
                };
                voteDiv.appendChild(sendButton);
            }
        });
    });
</script>